<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>AWS SDK v3 Client mock - v2.1.1</title><meta name="description" content="Documentation for AWS SDK v3 Client mock - v2.1.1"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">AWS SDK v3 Client mock - v2.1.1</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>AWS SDK v3 Client mock - v2.1.1</h2></div>
<div class="tsd-panel tsd-typography"><div align="center">


<a href="#aws-sdk-v3-client-mock" id="aws-sdk-v3-client-mock" style="color: inherit; text-decoration: none;">
  <h1>AWS SDK v3 Client mock</h1>
</a>
<p>Easy and powerful mocking of AWS SDK v3 Clients.</p>
<p><a href="https://www.npmjs.com/package/aws-sdk-client-mock"><img src="https://img.shields.io/npm/v/aws-sdk-client-mock?color=brightgreen&style=flat-square&label=npm+aws-sdk-client-mock" alt="npm aws-sdk-client-mock"></a>
<a href="https://www.npmjs.com/package/aws-sdk-client-mock-jest"><img src="https://img.shields.io/npm/v/aws-sdk-client-mock-jest?color=brightgreen&style=flat-square&label=npm+aws-sdk-client-mock-jest" alt="npm aws-sdk-client-mock-jest"></a></p>
</div>

<p>Library recommended by the AWS SDK for JavaScript team - see the <a href="https://aws.amazon.com/blogs/developer/mocking-modular-aws-sdk-for-javascript-v3-in-unit-tests/">introductory post on the AWS blog</a>.</p>
<p>Features:</p>
<ul>
<li>üåä&nbsp; <strong>fluent interface</strong> - declaring behavior is short and readable</li>
<li>üîç&nbsp; <strong>matching options</strong> - defining mock behavior by Command type and/or its input payload</li>
<li>üïµÔ∏è&nbsp; <strong>spying</strong> - checking if Commands were actually sent</li>
<li>üÉè&nbsp; <strong>Jest matchers</strong> - easily verifying sent Commands</li>
<li>üñãÔ∏è&nbsp; <strong>fully typed</strong> - same type control for declaring mock&#39;s behavior as when writing regular code</li>
<li>‚úÖ&nbsp; <strong>fully tested</strong> - reliable mocks help instead of impeding</li>
</ul>
<p>In action:</p>
<p><img src="media/aws-client-mock-example.gif" alt="aws-client-mock-example"></p>

<a href="#table-of-contents" id="table-of-contents" style="color: inherit; text-decoration: none;">
  <h3>Table of Contents</h3>
</a>
<ul>
<li><a href="#about-aws-sdk-v3">About AWS SDK v3</a></li>
<li><a href="#usage">Usage</a><ul>
<li><a href="#install">Install</a></li>
<li><a href="#import">Import</a></li>
<li><a href="#mock">Mock</a><ul>
<li><a href="#dynamodb-documentclient">DynamoDB DocumentClient</a></li>
<li><a href="#lib-storage-upload">Lib Storage Upload</a></li>
<li><a href="#s3-getobjectcommand">S3 GetObjectCommand</a></li>
<li><a href="#paginated-operations">Paginated operations</a></li>
<li><a href="#sdk-v2-style-mocks">SDK v2-style mocks</a></li>
</ul>
</li>
<li><a href="#inspect">Inspect</a></li>
<li><a href="#jest-matchers">Jest matchers</a></li>
</ul>
</li>
<li><a href="#api-reference">API Reference</a></li>
<li><a href="#aws-lambda-example">AWS Lambda example</a></li>
<li><a href="#caveats">Caveats</a><ul>
<li><a href="#mixed-aws-sdktypes-versions">Mixed @aws-sdk/types versions</a></li>
<li><a href="#order-of-mock-behaviors">Order of mock behaviors</a></li>
<li><a href="#order-of-type-and-instance-mocks">Order of type and instance mocks</a></li>
</ul>
</li>
</ul>

<a href="#about-aws-sdk-v3" id="about-aws-sdk-v3" style="color: inherit; text-decoration: none;">
  <h2>About AWS SDK v3</h2>
</a>
<p>The <a href="https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/welcome.html">AWS SDK for JavaScript version 3</a>,
is the new version of SDK to use in Node.js and browser.
It comes with modular architecture and improved typing,
thanks to being written in TypeScript.</p>
<p>The recommended way of using it is to create a <code>Client</code>
and use it to send <code>Commands</code>.</p>
<p>For example, using SNS Client to publish a message to a topic looks like that:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">PublishCommand</span><span class="hl-1">, </span><span class="hl-2">SNSClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-sns&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({});</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">sns</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">PublishCommand</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">TopicArn:</span><span class="hl-1"> </span><span class="hl-3">&#39;arn:aws:sns:us-east-1:111111111111:MyTopic&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">}));</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`Message published, id: </span><span class="hl-4">${</span><span class="hl-2">result</span><span class="hl-7">.</span><span class="hl-2">MessageId</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span>
</code></pre>
<p>This library provides an easy way to mock sending <code>Commands</code>
and define returned results depending on the <code>Command</code> type and payload.</p>

<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
  <h2>Usage</h2>
</a>

<a href="#install" id="install" style="color: inherit; text-decoration: none;">
  <h3>Install</h3>
</a>
<pre><code class="language-bash"><span class="hl-1">yarn </span><span class="hl-3">add</span><span class="hl-1"> </span><span class="hl-3">-D</span><span class="hl-1"> </span><span class="hl-3">aws-sdk-client-mock</span>
</code></pre>
<p>or</p>
<pre><code class="language-bash"><span class="hl-1">npm </span><span class="hl-3">install</span><span class="hl-1"> </span><span class="hl-3">-D</span><span class="hl-1"> </span><span class="hl-3">aws-sdk-client-mock</span>
</code></pre>
<p>With <code>npm</code>, peer dependencies will be installed, including <code>aws-crt</code>.
<strong>It requires <code>cmake</code> installed locally.</strong>
You can install it with <code>brew install cmake</code> or similar.
See full explanation <a href="https://github.com/m-radzikowski/aws-sdk-client-mock/issues/69#issuecomment-1035531094">here</a>.</p>

<a href="#import" id="import" style="color: inherit; text-decoration: none;">
  <h3>Import</h3>
</a>
<p>CommonJS:</p>
<pre><code class="language-javascript"><span class="hl-4">const</span><span class="hl-1"> {</span><span class="hl-5">mockClient</span><span class="hl-1">} = </span><span class="hl-6">require</span><span class="hl-1">(</span><span class="hl-3">&#39;aws-sdk-client-mock&#39;</span><span class="hl-1">);</span>
</code></pre>
<p>TypeScript / ES6:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">mockClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;aws-sdk-client-mock&#39;</span><span class="hl-1">;</span>
</code></pre>

<a href="#mock" id="mock" style="color: inherit; text-decoration: none;">
  <h3>Mock</h3>
</a>
<p>Create mock for all instances or for given instance of the AWS SDK Client:</p>
<pre><code class="language-typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">snsMock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">SNSClient</span><span class="hl-1">);</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dynamoDB</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">DynamoDBClient</span><span class="hl-1">({});</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dynamoDBMock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">dynamoDB</span><span class="hl-1">);</span>
</code></pre>
<p>By default, mocked <code>Client#send()</code> method returns <code>undefined</code>.</p>
<p>Using the obtained mock instance, you can specify the mock behavior
on receiving various commands to send.</p>
<p>See the <a href="https://m-radzikowski.github.io/aws-sdk-client-mock/classes/AwsStub.html">AwsStub API Reference</a>
for all available methods or check out the examples below.</p>
<p>Specify default mock behavior:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">onAnyCommand</span><span class="hl-1">().</span><span class="hl-6">resolves</span><span class="hl-1">({});</span><br/><br/><span class="hl-8">// same as:</span><br/><br/><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">resolves</span><span class="hl-1">({});</span>
</code></pre>
<p>Specify mock behavior on receiving given command only:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-1111-2222-3333-111122223333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span>
</code></pre>
<p>Specify mock behavior on receiving given command with given payload only:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-2">TopicArn:</span><span class="hl-1"> </span><span class="hl-3">&#39;arn:aws:sns:us-east-1:111111111111:MyTopic&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-4444-5555-6666-111122223333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span>
</code></pre>
<p>Not all payload parameters must be defined to match
(you can force strict matching by passing third param <code>strict: true</code>):</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-4444-5555-6666-111122223333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span>
</code></pre>
<p>Specify mock behavior on receiving given payload only:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">onAnyCommand</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">TopicArn:</span><span class="hl-1"> </span><span class="hl-3">&#39;arn:aws:sns:us-east-1:111111111111:MyTopic&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-4444-5555-6666-111122223333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span>
</code></pre>
<p>Multiple behaviors (for different commands and payloads) may be specified
for a single mock:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({ </span><span class="hl-8">// default for any command</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-1111-2222-3333-111122223333&#39;</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({ </span><span class="hl-8">// default for PublishCommand</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-4444-5555-6666-111122223333&#39;</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-2">TopicArn:</span><span class="hl-1"> </span><span class="hl-3">&#39;arn:aws:sns:us-east-1:111111111111:MyTopic&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({ </span><span class="hl-8">// for PublishCommand with given input</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-7777-8888-9999-111122223333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span>
</code></pre>
<p>Specify chained behaviors - next behaviors for consecutive calls:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-6">resolvesOnce</span><span class="hl-1">({ </span><span class="hl-8">// for the first command call</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-1111-1111-1111-111122223333&#39;</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">resolvesOnce</span><span class="hl-1">({ </span><span class="hl-8">// for the second command call</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-2222-2222-2222-111122223333&#39;</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({ </span><span class="hl-8">// for further calls</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-3333-3333-3333-111122223333&#39;</span><br/><span class="hl-1">    });</span>
</code></pre>
<p>Specify mock throwing an error:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">rejects</span><span class="hl-1">(</span><span class="hl-3">&#39;mocked rejection&#39;</span><span class="hl-1">);</span>
</code></pre>
<p>Specify custom mock function:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">callsFake</span><span class="hl-1">(</span><span class="hl-2">input</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">input</span><span class="hl-1">.</span><span class="hl-2">Message</span><span class="hl-1"> === </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">return</span><span class="hl-1"> {</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-1111-2222-3333-111122223333&#39;</span><span class="hl-1">};</span><br/><span class="hl-1">        } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">return</span><span class="hl-1"> {</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-4444-5555-6666-111122223333&#39;</span><span class="hl-1">};</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    });</span>
</code></pre>
<p>Together with <code>resolvesOnce()</code>, you can also use <code>rejectsOnce()</code> and <code>callsFakeOnce()</code>
to specify consecutive behaviors.</p>

<a href="#dynamodb-documentclient" id="dynamodb-documentclient" style="color: inherit; text-decoration: none;">
  <h4>DynamoDB DocumentClient</h4>
</a>
<p>You can mock the <code>DynamoDBDocumentClient</code> just like any other Client:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">DynamoDBClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-dynamodb&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">DynamoDBDocumentClient</span><span class="hl-1">, </span><span class="hl-2">QueryCommand</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/lib-dynamodb&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">ddbMock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">DynamoDBDocumentClient</span><span class="hl-1">);</span><br/><span class="hl-2">ddbMock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">QueryCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">Items:</span><span class="hl-1"> [{</span><span class="hl-2">pk:</span><span class="hl-1"> </span><span class="hl-3">&#39;a&#39;</span><span class="hl-1">, </span><span class="hl-2">sk:</span><span class="hl-1"> </span><span class="hl-3">&#39;b&#39;</span><span class="hl-1">}],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dynamodb</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">DynamoDBClient</span><span class="hl-1">({});</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">ddb</span><span class="hl-1"> = </span><span class="hl-2">DynamoDBDocumentClient</span><span class="hl-1">.</span><span class="hl-6">from</span><span class="hl-1">(</span><span class="hl-2">dynamodb</span><span class="hl-1">);</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">query</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">ddb</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">QueryCommand</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">TableName:</span><span class="hl-1"> </span><span class="hl-3">&#39;mock&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">}));</span>
</code></pre>

<a href="#lib-storage-upload" id="lib-storage-upload" style="color: inherit; text-decoration: none;">
  <h4>Lib Storage Upload</h4>
</a>
<p>To mock <code>@aws-sdk/lib-storage</code> <code>Upload</code> you need to mock
at least two commands: <code>CreateMultipartUploadCommand</code> and <code>UploadPartCommand</code>
used <a href="https://github.com/aws/aws-sdk-js-v3/blob/main/lib/lib-storage/src/Upload.ts">under the hood</a>:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">S3Client</span><span class="hl-1">, </span><span class="hl-2">CreateMultipartUploadCommand</span><span class="hl-1">, </span><span class="hl-2">UploadPartCommand</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-s3&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">Upload</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@aws-sdk/lib-storage&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">s3Mock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">S3Client</span><span class="hl-1">);</span><br/><span class="hl-2">s3Mock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">CreateMultipartUploadCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">UploadId:</span><span class="hl-1"> </span><span class="hl-3">&#39;1&#39;</span><span class="hl-1">});</span><br/><span class="hl-2">s3Mock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">UploadPartCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">ETag:</span><span class="hl-1"> </span><span class="hl-3">&#39;1&#39;</span><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">s3Upload</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Upload</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">client:</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">S3Client</span><span class="hl-1">({}),</span><br/><span class="hl-1">    </span><span class="hl-2">params:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">Bucket:</span><span class="hl-1"> </span><span class="hl-3">&#39;mock&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">Key:</span><span class="hl-1"> </span><span class="hl-3">&#39;test&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">Body:</span><span class="hl-1"> </span><span class="hl-3">&#39;x&#39;</span><span class="hl-1">.</span><span class="hl-6">repeat</span><span class="hl-1">(</span><span class="hl-9">6</span><span class="hl-1"> * </span><span class="hl-9">1024</span><span class="hl-1"> * </span><span class="hl-9">1024</span><span class="hl-1">), </span><span class="hl-8">// 6 MB</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">s3Upload</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-3">&#39;httpUploadProgress&#39;</span><span class="hl-1">, (</span><span class="hl-2">progress</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-2">progress</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">s3Upload</span><span class="hl-1">.</span><span class="hl-6">done</span><span class="hl-1">();</span>
</code></pre>
<p>This way, the  <code>Upload#done()</code> will complete successfuly.</p>
<p>To cause a failure, you need to specify the <code>rejects()</code> behavior
for one of the AWS SDK Commands used by the <code>@aws-sdk/lib-storage</code>.</p>
<p>For uploading a small file (under the defined multipart upload single part size),
<code>lib-storage</code> sends a <code>PutObjectCommand</code>. To make it fail:</p>
<pre><code class="language-ts"><span class="hl-2">s3Mock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PutObjectCommand</span><span class="hl-1">).</span><span class="hl-6">rejects</span><span class="hl-1">();</span>
</code></pre>
<p>For bigger files, it makes a series of calls including <code>CreateMultipartUploadCommand</code>,
<code>UploadPartCommand</code>, and <code>CompleteMultipartUploadCommand</code>. Making any of them fail will fail the upload:</p>
<pre><code class="language-ts"><span class="hl-2">s3Mock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">UploadPartCommand</span><span class="hl-1">).</span><span class="hl-6">rejects</span><span class="hl-1">();</span>
</code></pre>

<a href="#s3-getobjectcommand" id="s3-getobjectcommand" style="color: inherit; text-decoration: none;">
  <h4>S3 GetObjectCommand</h4>
</a>
<p>AWS SDK wraps the stream in the S3 <code>GetObjectCommand</code> result to provide utility methods to parse it.
To mock it, you need to call the wrapping function <code>sdkStreamMixin()</code> on the stream you provide as the command output:</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">GetObjectCommand</span><span class="hl-1">, </span><span class="hl-2">S3Client</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-s3&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">sdkStreamMixin</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/util-stream-node&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">mockClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;aws-sdk-client-mock&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">Readable</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;stream&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">createReadStream</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;fs&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">s3Mock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">S3Client</span><span class="hl-1">);</span><br/><br/><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-3">&#39;mocks get object&#39;</span><span class="hl-1">, </span><span class="hl-4">async</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-8">// create Stream from string</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">stream</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Readable</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-2">stream</span><span class="hl-1">.</span><span class="hl-6">push</span><span class="hl-1">(</span><span class="hl-3">&#39;hello world&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">stream</span><span class="hl-1">.</span><span class="hl-6">push</span><span class="hl-1">(</span><span class="hl-4">null</span><span class="hl-1">); </span><span class="hl-8">// end of stream</span><br/><br/><span class="hl-1">    </span><span class="hl-8">// alternatively: create Stream from file</span><br/><span class="hl-1">    </span><span class="hl-8">// const stream = createReadStream(&#39;./test/data.txt&#39;);</span><br/><br/><span class="hl-1">    </span><span class="hl-8">// wrap the Stream with SDK mixin</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sdkStream</span><span class="hl-1"> = </span><span class="hl-6">sdkStreamMixin</span><span class="hl-1">(</span><span class="hl-2">stream</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-2">s3Mock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">GetObjectCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">Body:</span><span class="hl-1"> </span><span class="hl-2">sdkStream</span><span class="hl-1">});</span><br/><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">s3</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">S3Client</span><span class="hl-1">({});</span><br/><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">getObjectResult</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">s3</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">GetObjectCommand</span><span class="hl-1">({</span><span class="hl-2">Bucket:</span><span class="hl-1"> </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">, </span><span class="hl-2">Key:</span><span class="hl-1"> </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">}));</span><br/><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">str</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">getObjectResult</span><span class="hl-1">.</span><span class="hl-2">Body</span><span class="hl-1">?.</span><span class="hl-6">transformToString</span><span class="hl-1">();</span><br/><br/><span class="hl-1">    </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">str</span><span class="hl-1">).</span><span class="hl-6">toBe</span><span class="hl-1">(</span><span class="hl-3">&#39;hello world&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code></pre>

<a href="#paginated-operations" id="paginated-operations" style="color: inherit; text-decoration: none;">
  <h4>Paginated operations</h4>
</a>
<p>To mock a <a href="https://aws.amazon.com/blogs/developer/pagination-using-async-iterators-in-modular-aws-sdk-for-javascript/">paginated operation</a>
results, simply mock the corresponding Command:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">DynamoDBClient</span><span class="hl-1">, </span><span class="hl-2">paginateQuery</span><span class="hl-1">, </span><span class="hl-2">QueryCommand</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-dynamodb&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">marshall</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/util-dynamodb&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dynamodbMock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">DynamoDBClient</span><span class="hl-1">);</span><br/><span class="hl-2">dynamodbMock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">QueryCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">Items:</span><span class="hl-1"> [</span><br/><span class="hl-1">        </span><span class="hl-6">marshall</span><span class="hl-1">({</span><span class="hl-2">pk:</span><span class="hl-1"> </span><span class="hl-3">&#39;a&#39;</span><span class="hl-1">, </span><span class="hl-2">sk:</span><span class="hl-1"> </span><span class="hl-3">&#39;b&#39;</span><span class="hl-1">}),</span><br/><span class="hl-1">        </span><span class="hl-6">marshall</span><span class="hl-1">({</span><span class="hl-2">pk:</span><span class="hl-1"> </span><span class="hl-3">&#39;c&#39;</span><span class="hl-1">, </span><span class="hl-2">sk:</span><span class="hl-1"> </span><span class="hl-3">&#39;d&#39;</span><span class="hl-1">}),</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dynamodb</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">DynamoDBClient</span><span class="hl-1">({});</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">paginator</span><span class="hl-1"> = </span><span class="hl-6">paginateQuery</span><span class="hl-1">({</span><span class="hl-2">client:</span><span class="hl-1"> </span><span class="hl-2">dynamodb</span><span class="hl-1">}, {</span><span class="hl-2">TableName:</span><span class="hl-1"> </span><span class="hl-3">&#39;mock&#39;</span><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">items</span><span class="hl-1"> = [];</span><br/><span class="hl-0">for</span><span class="hl-1"> </span><span class="hl-0">await</span><span class="hl-1"> (</span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">page</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">paginator</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">items</span><span class="hl-1">.</span><span class="hl-6">push</span><span class="hl-1">(...</span><span class="hl-2">page</span><span class="hl-1">.</span><span class="hl-2">Items</span><span class="hl-1"> || []);</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#sdk-v2-style-mocks" id="sdk-v2-style-mocks" style="color: inherit; text-decoration: none;">
  <h4>SDK v2-style mocks</h4>
</a>
<p>The AWS SDK v3 gives an option to use it similarly to v2 SDK,
with command method call instead of <code>send()</code>:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">SNS</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-sns&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNS</span><span class="hl-1">({});</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">sns</span><span class="hl-1">.</span><span class="hl-6">publish</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">TopicArn:</span><span class="hl-1"> </span><span class="hl-3">&#39;arn:aws:sns:us-east-1:111111111111:MyTopic&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Although this approach is not recommended by AWS,
those calls can be mocked in the standard way:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">PublishCommand</span><span class="hl-1">, </span><span class="hl-2">SNSClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-sns&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">snsMock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">SNSClient</span><span class="hl-1">);</span><br/><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-1111-2222-3333-111122223333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span>
</code></pre>
<p>Notice that in mocks you still need to use <code>SNSClient</code>, not <code>SNS</code>,
as well as <code>Command</code> classes.</p>

<a href="#inspect" id="inspect" style="color: inherit; text-decoration: none;">
  <h3>Inspect</h3>
</a>
<p>Inspect received calls:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">calls</span><span class="hl-1">(); </span><span class="hl-8">// all received calls</span><br/><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">call</span><span class="hl-1">(</span><span class="hl-9">0</span><span class="hl-1">); </span><span class="hl-8">// first received call</span>
</code></pre>
<p>Get calls of a specified command:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">commandCalls</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">)</span>
</code></pre>
<p>Get calls of a specified command with given payload
(you can force strict matching by passing third param <code>strict: true</code>):</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">commandCalls</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">, {</span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">})</span>
</code></pre>
<p>Under the hood, the library uses <a href="https://sinonjs.org/">Sinon.js</a> <code>stub</code>.
You can get the stub instance to configure and use it directly:</p>
<pre><code class="language-typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">snsSendStub</span><span class="hl-1"> = </span><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">;</span>
</code></pre>

<a href="#jest-matchers" id="jest-matchers" style="color: inherit; text-decoration: none;">
  <h3>Jest matchers</h3>
</a>
<p>Custom <a href="https://jestjs.io/">Jest</a> matchers simplify verification
that the mocked Client was called with given Commands.</p>
<p>Matchers are published as a separate package. Install it:</p>
<pre><code class="language-bash"><span class="hl-1">yarn </span><span class="hl-3">add</span><span class="hl-1"> </span><span class="hl-3">-D</span><span class="hl-1"> </span><span class="hl-3">aws-sdk-client-mock-jest</span><br/><span class="hl-8"># or:</span><br/><span class="hl-1">npm </span><span class="hl-3">install</span><span class="hl-1"> </span><span class="hl-3">-D</span><span class="hl-1"> </span><span class="hl-3">aws-sdk-client-mock-jest</span>
</code></pre>
<p>Usage (notice the <code>import</code>):</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-3">&#39;aws-sdk-client-mock-jest&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// a PublishCommand was sent to SNS</span><br/><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">snsMock</span><span class="hl-1">).</span><span class="hl-6">toHaveReceivedCommand</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// two PublishCommands were sent to SNS</span><br/><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">snsMock</span><span class="hl-1">).</span><span class="hl-6">toHaveReceivedCommandTimes</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">, </span><span class="hl-9">2</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// a PublishCommand with Message &quot;My message&quot; was sent to SNS</span><br/><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">snsMock</span><span class="hl-1">).</span><span class="hl-6">toHaveReceivedCommandWith</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">, {</span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">});</span><br/><br/><span class="hl-8">// the second command sent to SNS is a PublishCommand with Message &quot;My message&quot;</span><br/><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">snsMock</span><span class="hl-1">).</span><span class="hl-6">toHaveReceivedNthCommandWith</span><span class="hl-1">(</span><span class="hl-9">2</span><span class="hl-1">, </span><span class="hl-2">PublishCommand</span><span class="hl-1">, {</span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">});</span><br/><br/><span class="hl-8">// the second PublishCommand sent to SNS has Message &quot;My message&quot;</span><br/><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">snsMock</span><span class="hl-1">).</span><span class="hl-6">toHaveReceivedNthSpecificCommandWith</span><span class="hl-1">(</span><span class="hl-9">2</span><span class="hl-1">, </span><span class="hl-2">PublishCommand</span><span class="hl-1">, {</span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">});</span>
</code></pre>
<p>Shorter aliases exist, like <code>toReceiveCommandTimes()</code>. </p>
<p>To use those matchers with <a href="https://vitest.dev/">Vitest</a>, set <code>test.globals</code> to <code>true</code> in <code>vite.config.js</code>
(see <a href="https://github.com/m-radzikowski/aws-sdk-client-mock/issues/139">#139</a>).</p>
<p>To use the matchers outside of Jest, you can pull in the <a href="https://www.npmjs.com/package/expect">expect</a> library separately
and add it to the global scope directly, e.g.:</p>
<pre><code class="language-ts"><span class="hl-4">const</span><span class="hl-1"> {</span><span class="hl-5">expect</span><span class="hl-1">} = </span><span class="hl-6">require</span><span class="hl-1">(</span><span class="hl-3">&quot;expect&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">(</span><span class="hl-2">globalThis</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-10">any</span><span class="hl-1">).</span><span class="hl-2">expect</span><span class="hl-1"> = </span><span class="hl-2">expect</span><span class="hl-1">;</span><br/><span class="hl-6">require</span><span class="hl-1">(</span><span class="hl-3">&quot;aws-sdk-client-mock-jest&quot;</span><span class="hl-1">);</span>
</code></pre>

<a href="#api-reference" id="api-reference" style="color: inherit; text-decoration: none;">
  <h2>API Reference</h2>
</a>
<p>See the <a href="https://m-radzikowski.github.io/aws-sdk-client-mock/">full API Reference</a>.</p>

<a href="#aws-lambda-example" id="aws-lambda-example" style="color: inherit; text-decoration: none;">
  <h2>AWS Lambda example</h2>
</a>
<p>Example below uses Jest as a test framework, but mocks will work with any testing library.</p>
<p>Let&#39;s take a simple Lambda function that takes a list of messages,
sends them to SNS topic and returns message IDs:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">PublishCommand</span><span class="hl-1">, </span><span class="hl-2">SNSClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-sns&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">snsTopicArn</span><span class="hl-1"> = </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">env</span><span class="hl-1">.</span><span class="hl-5">SNS_TOPIC_ARN</span><span class="hl-1"> || </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">handler</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-2">event</span><span class="hl-1">: </span><span class="hl-10">Event</span><span class="hl-1">): </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">[]&gt; </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">promises</span><span class="hl-1"> = </span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">messages</span><span class="hl-1">.</span><span class="hl-6">map</span><span class="hl-1">(</span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-2">msg</span><span class="hl-1">, </span><span class="hl-2">idx</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">publish</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">sns</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">PublishCommand</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-2">TopicArn:</span><span class="hl-1"> </span><span class="hl-2">snsTopicArn</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-2">msg</span><span class="hl-1">,</span><br/><span class="hl-1">    }));</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">publish</span><span class="hl-1">.</span><span class="hl-2">MessageId</span><span class="hl-1">!;</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-10">Promise</span><span class="hl-1">.</span><span class="hl-6">all</span><span class="hl-1">(</span><span class="hl-2">promises</span><span class="hl-1">);</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-4">interface</span><span class="hl-1"> </span><span class="hl-10">Event</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">messages</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">[];</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Then the tests could look like this:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">mockClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;aws-sdk-client-mock&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">PublishCommand</span><span class="hl-1">, </span><span class="hl-2">SNSClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-sns&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">handler</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;../src&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">snsMock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">SNSClient</span><span class="hl-1">);</span><br/><br/><span class="hl-8">/**</span><br/><span class="hl-8"> * To be sure that unit tests are independent from each other,</span><br/><span class="hl-8"> * reset mock behavior between the tests.</span><br/><span class="hl-8"> */</span><br/><span class="hl-6">beforeEach</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">reset</span><span class="hl-1">();</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-3">&#39;message IDs are returned&#39;</span><span class="hl-1">, </span><span class="hl-4">async</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-1111-2222-3333-111122223333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">handler</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">messages:</span><span class="hl-1"> [</span><span class="hl-3">&#39;one&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;two&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;three&#39;</span><span class="hl-1">]</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">result</span><span class="hl-1">).</span><span class="hl-6">toHaveLength</span><span class="hl-1">(</span><span class="hl-9">3</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">result</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">]).</span><span class="hl-6">toBe</span><span class="hl-1">(</span><span class="hl-3">&#39;12345678-1111-2222-3333-111122223333&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-3">&#39;SNS Client is called with PublishCommand&#39;</span><span class="hl-1">, </span><span class="hl-4">async</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;111-222-333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">handler</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">messages:</span><span class="hl-1"> [</span><span class="hl-3">&#39;qq&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;xx&#39;</span><span class="hl-1">]</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">snsMock</span><span class="hl-1">).</span><span class="hl-6">toHaveReceivedCommandTimes</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">, </span><span class="hl-9">2</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code></pre>
<p>For more examples, see the <a href="packages/aws-sdk-client-mock/test/mockClient.test.ts">unit tests</a>.</p>

<a href="#caveats" id="caveats" style="color: inherit; text-decoration: none;">
  <h2>Caveats</h2>
</a>

<a href="#mixed-aws-sdktypes-versions" id="mixed-aws-sdktypes-versions" style="color: inherit; text-decoration: none;">
  <h3>Mixed @aws-sdk/types versions</h3>
</a>
<p>If you have multiple <code>@aws-sdk</code> packages in dependencies in different versions,
or one of your dependencies depends on the <code>@aws-sdk</code> package(s)
in a different version than the one you use,
you may end up with different <code>@aws-sdk/types</code> dependency versions required.</p>
<p>If the one installed on the top level in <code>node_modules</code>
is in a different version than required by the Client you try to mock,
the types will be incompatible. This is because the mocking library
will use the <code>@aws-sdk/types</code> version from the top level of <code>node_modules</code>,
while your Client may be using a different one.</p>
<p>This often results in a long error stack trace looking similar to this:</p>
<pre><code><span class="hl-2">Argument</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;typeof SomeCommand&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">not</span><span class="hl-1"> </span><span class="hl-2">assignable</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">parameter</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;new (input: SomeCommandInput) =&gt; AwsCommand&lt;SomeCommandInput, MetadataBearer, any, any&gt;&#39;</span><br/><span class="hl-1">  </span><span class="hl-2">Types</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">construct</span><span class="hl-1"> </span><span class="hl-2">signatures</span><span class="hl-1"> </span><span class="hl-2">are</span><span class="hl-1"> </span><span class="hl-2">incompatible</span><span class="hl-1">.</span><br/><span class="hl-1">    </span><span class="hl-2">Type</span><span class="hl-1"> </span><span class="hl-3">&#39;new (input: SomeCommandInput) =&gt; SomeCommand&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">not</span><span class="hl-1"> </span><span class="hl-2">assignable</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;new (input: SomeCommandInput) =&gt; AwsCommand&lt;SomeCommandInput, MetadataBearer, any, any&gt;&#39;</span><span class="hl-1">.</span><br/><span class="hl-1">      </span><span class="hl-2">Construct</span><span class="hl-1"> </span><span class="hl-2">signature</span><span class="hl-1"> </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">types</span><span class="hl-1"> </span><span class="hl-3">&#39;SomeCommand&#39;</span><span class="hl-1"> </span><span class="hl-2">and</span><span class="hl-1"> </span><span class="hl-3">&#39;AwsCommand&lt;SomeCommandInput, MetadataBearer, any, any&gt;&#39;</span><span class="hl-1"> </span><span class="hl-2">are</span><span class="hl-1"> </span><span class="hl-2">incompatible</span><span class="hl-1">.</span><br/><span class="hl-1">        </span><span class="hl-2">The</span><span class="hl-1"> </span><span class="hl-2">types</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-3">&#39;middlewareStack.concat&#39;</span><span class="hl-1"> </span><span class="hl-2">are</span><span class="hl-1"> </span><span class="hl-2">incompatible</span><span class="hl-1"> </span><span class="hl-2">between</span><span class="hl-1"> </span><span class="hl-2">these</span><span class="hl-1"> </span><span class="hl-2">types</span><span class="hl-1">.</span><br/><span class="hl-1">          </span><span class="hl-2">Type</span><span class="hl-1"> </span><span class="hl-3">&#39;&lt;InputType extends SomeCommandInput, OutputType extends SomeCommandOutput&gt;(from: MiddlewareStack&lt;InputType, OutputType&gt;) =&gt; MiddlewareStack&lt;...&gt;&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">not</span><span class="hl-1"> </span><span class="hl-2">assignable</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;&lt;InputType extends SomeCommandInput, OutputType extends MetadataBearer&gt;(from: MiddlewareStack&lt;InputType, OutputType&gt;) =&gt; MiddlewareStack&lt;...&gt;&#39;</span><span class="hl-1">.</span><br/><span class="hl-1">            </span><span class="hl-2">Types</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">parameters</span><span class="hl-1"> </span><span class="hl-3">&#39;from&#39;</span><span class="hl-1"> </span><span class="hl-2">and</span><span class="hl-1"> </span><span class="hl-3">&#39;from&#39;</span><span class="hl-1"> </span><span class="hl-2">are</span><span class="hl-1"> </span><span class="hl-2">incompatible</span><span class="hl-1">.</span><br/><span class="hl-1">              </span><span class="hl-2">Type</span><span class="hl-1"> </span><span class="hl-3">&#39;MiddlewareStack&lt;InputType, OutputType&gt;&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">not</span><span class="hl-1"> </span><span class="hl-2">assignable</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;MiddlewareStack&lt;InputType, SomeCommandOutput&gt;&#39;</span><span class="hl-1">.</span><br/><span class="hl-1">                </span><span class="hl-2">Types</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">property</span><span class="hl-1"> </span><span class="hl-3">&#39;addRelativeTo&#39;</span><span class="hl-1"> </span><span class="hl-2">are</span><span class="hl-1"> </span><span class="hl-2">incompatible</span><span class="hl-1">.</span><br/><span class="hl-1">                  </span><span class="hl-2">Type</span><span class="hl-1"> </span><span class="hl-3">&#39;(middleware: MiddlewareType&lt;InputType, OutputType&gt;, options: RelativeMiddlewareOptions) =&gt; void&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">not</span><span class="hl-1"> </span><span class="hl-2">assignable</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;(middleware: MiddlewareType&lt;InputType, SomeCommandOutput&gt;, options: RelativeMiddlewareOptions) =&gt; void&#39;</span><span class="hl-1">.</span><br/><span class="hl-1">                    </span><span class="hl-2">Types</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">parameters</span><span class="hl-1"> </span><span class="hl-3">&#39;middleware&#39;</span><span class="hl-1"> </span><span class="hl-2">and</span><span class="hl-1"> </span><span class="hl-3">&#39;middleware&#39;</span><span class="hl-1"> </span><span class="hl-2">are</span><span class="hl-1"> </span><span class="hl-2">incompatible</span><span class="hl-1">.</span><br/><span class="hl-1">                      </span><span class="hl-2">Type</span><span class="hl-1"> </span><span class="hl-3">&#39;MiddlewareType&lt;InputType, SomeCommandOutput&gt;&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">not</span><span class="hl-1"> </span><span class="hl-2">assignable</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;MiddlewareType&lt;InputType, OutputType&gt;&#39;</span><span class="hl-1">.</span><br/><span class="hl-1">                        </span><span class="hl-2">Type</span><span class="hl-1"> </span><span class="hl-3">&#39;InitializeMiddleware&lt;InputType, SomeCommandOutput&gt;&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">not</span><span class="hl-1"> </span><span class="hl-2">assignable</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;MiddlewareType&lt;InputType, OutputType&gt;&#39;</span><span class="hl-1">.</span><br/><span class="hl-1">                          </span><span class="hl-2">Type</span><span class="hl-1"> </span><span class="hl-3">&#39;InitializeMiddleware&lt;InputType, SomeCommandOutput&gt;&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">not</span><span class="hl-1"> </span><span class="hl-2">assignable</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;InitializeMiddleware&lt;InputType, OutputType&gt;&#39;</span><span class="hl-1">.</span><br/><span class="hl-1">                            </span><span class="hl-2">Call</span><span class="hl-1"> </span><span class="hl-2">signature</span><span class="hl-1"> </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">types</span><span class="hl-1"> </span><span class="hl-3">&#39;InitializeHandler&lt;InputType, SomeCommandOutput&gt;&#39;</span><span class="hl-1"> </span><span class="hl-2">and</span><span class="hl-1"> </span><span class="hl-3">&#39;InitializeHandler&lt;InputType, OutputType&gt;&#39;</span><span class="hl-1"> </span><span class="hl-2">are</span><span class="hl-1"> </span><span class="hl-2">incompatible</span><span class="hl-1">.</span><br/><span class="hl-1">                              </span><span class="hl-2">Type</span><span class="hl-1"> </span><span class="hl-3">&#39;Promise&lt;InitializeHandlerOutput&lt;SomeCommandOutput&gt;&gt;&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">not</span><span class="hl-1"> </span><span class="hl-2">assignable</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;Promise&lt;InitializeHandlerOutput&lt;OutputType&gt;&gt;&#39;</span><span class="hl-1">.</span><br/><span class="hl-1">                                </span><span class="hl-2">Type</span><span class="hl-1"> </span><span class="hl-3">&#39;InitializeHandlerOutput&lt;SomeCommandOutput&gt;&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">not</span><span class="hl-1"> </span><span class="hl-2">assignable</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;InitializeHandlerOutput&lt;OutputType&gt;&#39;</span><span class="hl-1">.</span><br/><span class="hl-1">                                  </span><span class="hl-2">Types</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">property</span><span class="hl-1"> </span><span class="hl-3">&#39;output&#39;</span><span class="hl-1"> </span><span class="hl-2">are</span><span class="hl-1"> </span><span class="hl-2">incompatible</span><span class="hl-1">.</span><br/><span class="hl-1">                                    </span><span class="hl-2">Type</span><span class="hl-1"> </span><span class="hl-3">&#39;SomeCommandOutput&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">not</span><span class="hl-1"> </span><span class="hl-2">assignable</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;OutputType&#39;</span><span class="hl-1">.</span><br/><span class="hl-1">                                      </span><span class="hl-3">&#39;SomeCommandOutput&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">assignable</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">the</span><span class="hl-1"> </span><span class="hl-2">constraint</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;OutputType&#39;</span><span class="hl-1">, </span><span class="hl-2">but</span><span class="hl-1"> </span><span class="hl-3">&#39;OutputType&#39;</span><span class="hl-1"> </span><span class="hl-2">could</span><span class="hl-1"> </span><span class="hl-2">be</span><span class="hl-1"> </span><span class="hl-2">instantiated</span><span class="hl-1"> </span><span class="hl-0">with</span><span class="hl-1"> </span><span class="hl-2">a</span><span class="hl-1"> </span><span class="hl-2">different</span><span class="hl-1"> </span><span class="hl-2">subtype</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">constraint</span><span class="hl-1"> </span><span class="hl-3">&#39;MetadataBearer&#39;</span><span class="hl-1">.</span>
</code></pre>
<p>This is a common problem when using the Amplify library.</p>
<p>The solution for this is to force the version of the <code>@aws-sdk/types</code>
matching your Clients to be installed on the top-level of <code>node_modules</code>.</p>
<p>The easiest way to do this is to add the <code>@aws-sdk/types</code>
in the selected version to <code>package.json</code> explicitly.</p>
<p>However, depending on your project structure, you may need to force it differently.
For example, when using <code>yarn</code>, you can add the <code>@aws-sdk/types</code> in selected version
to the <a href="https://classic.yarnpkg.com/en/docs/selective-version-resolutions/">resolutions</a>
section in <code>package.json</code>.</p>

<a href="#order-of-mock-behaviors" id="order-of-mock-behaviors" style="color: inherit; text-decoration: none;">
  <h3>Order of mock behaviors</h3>
</a>
<p>Wider Command matchers must be declared first,
otherwise, they will take precedence over previous ones.</p>
<p>In this case, all <code>PublishCommand</code> sends will return message ID <code>222</code>:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">  .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">, </span><span class="hl-2">myInput</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;111&#39;</span><span class="hl-1">})</span><br/><span class="hl-1">  .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;222&#39;</span><span class="hl-1">});</span>
</code></pre>
<p>If the order of the declarations is switched, sends with input matching <code>myInput</code>
will return ID <code>111</code> and all others <code>222</code>.</p>
<p>It works similarly with <code>onAnyCommand()</code>.</p>

<a href="#order-of-type-and-instance-mocks" id="order-of-type-and-instance-mocks" style="color: inherit; text-decoration: none;">
  <h3>Order of type and instance mocks</h3>
</a>
<p>When you create both a Client type mock
and a specific Client instance mock(s),
you need to declare type mock last.
Otherwise, the other instances will not be mocked.</p>
<p>Right now if you create a mock for the Client type,
and then mock a specific instance of this Client,
with the order of mocking as here:</p>
<pre><code class="language-typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns1</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({}); </span><span class="hl-8">// not mocked</span><br/><br/><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">SNSClient</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;123&#39;</span><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns2</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({}); </span><span class="hl-8">// mocked</span><br/><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">sns2</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;456&#39;</span><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns3</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({}); </span><span class="hl-8">// not mocked</span>
</code></pre>
<p>Declaring mocks in this order will fix it:</p>
<pre><code class="language-typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns1</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({}); </span><span class="hl-8">// mocked - default</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns2</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({}); </span><span class="hl-8">// mocked</span><br/><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">sns2</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;456&#39;</span><span class="hl-1">});</span><br/><br/><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">SNSClient</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;123&#39;</span><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns3</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({}); </span><span class="hl-8">// mocked - default</span>
</code></pre>
<p>PRs to fix this are welcome.</p>

<a href="#using-with-mocha" id="using-with-mocha" style="color: inherit; text-decoration: none;">
  <h3>Using with Mocha</h3>
</a>
<p>When testing with Mocha, call <code>mockClient()</code>
in the <code>beforeEach()</code> method, not in the global scope,
to prevent overriding the mock between test files.
See <a href="https://github.com/m-radzikowski/aws-sdk-client-mock/issues/64">this</a>
for more details.</p>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">AWS SDK v3 <wbr/>Client mock -<wbr/> v2.1.1</a>
<ul></ul></li></ul></div></details></nav>
<nav class="tsd-navigation secondary menu-sticky">
<ul>
<li class="tsd-kind-class"><a href="classes/AwsStub.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-class)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-128-path"></rect><path d="M11.898 16.1201C11.098 16.1201 10.466 15.8961 10.002 15.4481C9.53803 15.0001 9.30603 14.3841 9.30603 13.6001V9.64012C9.30603 8.85612 9.53803 8.24012 10.002 7.79212C10.466 7.34412 11.098 7.12012 11.898 7.12012C12.682 7.12012 13.306 7.34812 13.77 7.80412C14.234 8.25212 14.466 8.86412 14.466 9.64012H13.386C13.386 9.14412 13.254 8.76412 12.99 8.50012C12.734 8.22812 12.37 8.09212 11.898 8.09212C11.426 8.09212 11.054 8.22412 10.782 8.48812C10.518 8.75212 10.386 9.13212 10.386 9.62812V13.6001C10.386 14.0961 10.518 14.4801 10.782 14.7521C11.054 15.0161 11.426 15.1481 11.898 15.1481C12.37 15.1481 12.734 15.0161 12.99 14.7521C13.254 14.4801 13.386 14.0961 13.386 13.6001H14.466C14.466 14.3761 14.234 14.9921 13.77 15.4481C13.306 15.8961 12.682 16.1201 11.898 16.1201Z" fill="var(--color-text)" id="icon-128-text"></path></svg>Aws<wbr/>Stub</a></li>
<li class="tsd-kind-class"><a href="classes/CommandBehavior.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-128-path"></use><use href="#icon-128-text"></use></svg>Command<wbr/>Behavior</a></li>
<li class="tsd-kind-interface"><a href="interfaces/AwsError.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-interface)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-256-path"></rect><path d="M9.51 16V15.016H11.298V8.224H9.51V7.24H14.19V8.224H12.402V15.016H14.19V16H9.51Z" fill="var(--color-text)" id="icon-256-text"></path></svg>Aws<wbr/>Error</a></li>
<li class="tsd-kind-interface"><a href="interfaces/Behavior.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-256-path"></use><use href="#icon-256-text"></use></svg>Behavior</a></li>
<li class="tsd-kind-type-alias"><a href="types/AwsClientBehavior.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-4194304-path"></rect><path d="M11.31 16V8.224H8.91V7.24H14.79V8.224H12.39V16H11.31Z" fill="var(--color-text)" id="icon-4194304-text"></path></svg>Aws<wbr/>Client<wbr/>Behavior</a></li>
<li class="tsd-kind-type-alias"><a href="types/AwsClientStub.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg>Aws<wbr/>Client<wbr/>Stub</a></li>
<li class="tsd-kind-type-alias"><a href="types/AwsCommand.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg>Aws<wbr/>Command</a></li>
<li class="tsd-kind-function"><a href="functions/mockClient.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-function)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-64-path"></rect><path d="M9.39 16V7.24H14.55V8.224H10.446V11.128H14.238V12.112H10.47V16H9.39Z" fill="var(--color-text)" id="icon-64-text"></path></svg>mock<wbr/>Client</a></li></ul></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>